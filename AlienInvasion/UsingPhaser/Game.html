<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
    type: Phaser.WEBGL,
    parent: 'phaser-example',
    width: 600,
    height: 600,
        physics: {
        default: 'impact',
        impact: {
            setBounds: {
                x: 0,
                y: 0,
                width: 600,
                height: 600,
                thickness: 32
            }
        }
    },
    scene: {
        preload: preload,
        create: create,
		update: update,
		extend: {
            player: null,
            thrust: null,
            flares: null,
            bullets: null,
            lastFired: 0,
			//createAliens: createAliens
		}
	}
};
	var game = new Phaser.Game(config);
	var sprite;
	
	function preload ()
	{
		this.load.image('grey-square', 'images/grey-square.png');
	}
	
	function create ()
	{
		var Bullet = new Phaser.Class({
        Extends: Phaser.GameObjects.Image,
        initialize:

        function Bullet (scene)
        {
            Phaser.GameObjects.Image.call(this, scene, 0, 0, 'grey-square');

            this.speed = 0;
            this.born = 0;
        },
		update: function (time, delta)
        {
            this.x += this.speed * delta;

            this.born += delta;

            if (this.born > 1000)
            {
                this.setActive(false);
                this.setVisible(false);
            }
        }
		fire: function (player)
        {
            this.setPosition(player.x, player.y);

            if (player.flipX)
            {
                //  Facing left
                this.speed = Phaser.Math.GetSpeed(-1000 + player.vel.x, 1);
            }
            else
            {
                //  Facing right
                this.speed = Phaser.Math.GetSpeed(1000 + player.vel.x, 1);
            }

            this.born = 0;
        },
		this.bullets = this.add.group({ classType: Bullet, runChildUpdate: true});
		
		this.player = this.impact.add.sprite(1600, 200, 'grey-square');
		game.canvas.addEventListener('mousedown', function () {
			game.input.mouse.requestPointerLock();
			}
		});
        
        
        
        
	function update (time, delta){
		this.bullets.children.each(function(b) {
			if (b.active)
			{
				this.flares.setPosition(b.x, b.y);
				this.flares.setSpeed(b.speed + 500 * -1);
				this.flares.emitParticle(1);
			}
		}, this);
	}
    this.thrust.setPosition(this.player.x, this.player.y);

	this.input.on('pointermove', function (pointer) {

        if (this.input.mouse.locked)
        {
            sprite.x += pointer.movementX;
            sprite.y += pointer.movementY;

            sprite.x = Phaser.Math.Wrap(sprite.x, 0, game.renderer.width);
            sprite.y = Phaser.Math.Wrap(sprite.y, 0, game.renderer.height);

            if (pointer.movementX > 0) { sprite.setRotation(0.1); }
            else if (pointer.movementX < 0) { sprite.setRotation(-0.1); }
            else { sprite.setRotation(0); }
			var bullet = this.bullet.get();
			bullet.setActive(true);
			bullet.setVisible(true);
			if (bullet)
			{
				bullet.fire(this.player);

				this.lastFired = time + 100;
			}
			
        }
    }, this);
	this.input.keyboard.on('keydown_Q', function (event) {
        if (game.input.mouse.locked)
        {
            game.input.mouse.releasePointerLock();
        }
    }, 0, this);
}


		
    </script>

</body>
</html>